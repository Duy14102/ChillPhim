import{r as u,j as e,B as w,S as p}from"./index-DS5FZUpn.js";import{T as h}from"./ToastUpdate-CK40nDRU.js";function C({movies:t,axios:m,callBack:x}){const o=u.useRef(null),[l,s]=u.useReducer((n,c)=>({...n,...c}),{name:"",stars:"",content:""});function i(n){n.preventDefault(),o.current=w.loading("Chờ một chút...");const c={method:"post",url:"http://localhost:3000/api/v1newComments",data:{id:t._id,data:{name:l.name,stars:l.stars,content:l.content,time:Date.now()}}};m(c).then(a=>{if(localStorage.getItem("commentStorage")&&!JSON.parse(localStorage.getItem("commentStorage")).includes(t._id)){const r=JSON.parse(localStorage.getItem("commentStorage"));r.push(t._id),localStorage.setItem("commentStorage",JSON.stringify(r))}else{const r=[];r.push(t._id),localStorage.setItem("commentStorage",JSON.stringify(r))}s({name:"",stars:null,content:""}),x(),h({type:1,message:a.data.message,refCur:o.current})}).catch(a=>{h({type:2,message:a.response.data.message,refCur:o.current})})}return e.jsxs("div",{className:"rateAndReview",children:[e.jsx("p",{className:"noReviewTitle",children:"Chưa có ai đánh giá cả."}),e.jsxs("h1",{className:"noReviewSubtitle",children:["Hãy là người đầu tiên đánh giá ",e.jsxs("span",{style:{color:"#fff"},children:['"',t!=null&&t.movieSeason&&(t==null?void 0:t.movieSeason)!==""?`${t==null?void 0:t.title} (Phần ${t==null?void 0:t.movieSeason})`:t==null?void 0:t.title,'"']})]}),e.jsxs("form",{onSubmit:n=>i(n),children:[e.jsxs("div",{className:"noReviewFlex",children:[e.jsxs("div",{style:{width:"49%"},className:"noReviewFlexChild",children:[e.jsx("label",{className:"labelContent",htmlFor:"noReviewNewIn4",children:"Tên *"}),e.jsx("input",{value:l.name,onChange:n=>s({name:n.target.value}),className:"textareaContent",id:"noReviewNewIn4",required:!0})]}),e.jsx("div",{style:{width:"49%"},className:"noReviewFlexChild",children:e.jsxs("div",{className:"rate",children:[e.jsx("input",{type:"radio",style:{display:"none"},required:!0}),e.jsx("input",{type:"radio",onChange:n=>s({stars:n.target.value}),id:"star5",name:"rate",value:"5"}),e.jsx("label",{title:"text",htmlFor:"star5"}),e.jsx("input",{type:"radio",onChange:n=>s({stars:n.target.value}),id:"star4",name:"rate",value:"4"}),e.jsx("label",{title:"text",htmlFor:"star4"}),e.jsx("input",{type:"radio",onChange:n=>s({stars:n.target.value}),id:"star3",name:"rate",value:"3"}),e.jsx("label",{title:"text",htmlFor:"star3"}),e.jsx("input",{type:"radio",onChange:n=>s({stars:n.target.value}),id:"star2",name:"rate",value:"2"}),e.jsx("label",{title:"text",htmlFor:"star2"}),e.jsx("input",{type:"radio",onChange:n=>s({stars:n.target.value}),id:"star1",name:"rate",value:"1"}),e.jsx("label",{title:"text",htmlFor:"star1"})]})})]}),e.jsxs("div",{className:"noReviewFlexChild",children:[e.jsx("label",{className:"labelContent",htmlFor:"noReviewNewContent",children:"Nội dung *"}),e.jsx("textarea",{value:l.content,onChange:n=>s({content:n.target.value}),style:{height:200},className:"textareaContent",id:"noReviewNewContent",required:!0})]}),e.jsx("button",{type:"submit",className:"noReviewButton",children:"Gửi"})]})]})}function R({movies:t,axios:m,callBack:x}){const o=u.useRef(null),[l,s]=u.useReducer((a,r)=>({...a,...r}),{wantReview:!1,name:"",stars:"",content:"",countComments:1}),i=localStorage.getItem("commentStorage"),n=a=>"★★★★★☆☆☆☆☆".slice(5-a,10-a);function c(a){a.preventDefault(),o.current=w.loading("Chờ một chút...");const r={method:"post",url:"http://localhost:3000/api/v1newComments",data:{id:t._id,data:{name:l.name,stars:l.stars,content:l.content,time:Date.now()}}};m(r).then(g=>{if(i&&!JSON.parse(i).includes(t._id)){const d=JSON.parse(localStorage.getItem("commentStorage"));d.push(t._id),localStorage.setItem("commentStorage",JSON.stringify(d))}else{const d=[];d.push(t._id),localStorage.setItem("commentStorage",JSON.stringify(d))}s({wantReview:!1,name:"",stars:"",content:""}),x(),h({type:1,message:g.data.message,refCur:o.current})}).catch(g=>{h({type:2,message:g.response.data.message,refCur:o.current})})}return e.jsxs("div",{className:"rateAndReview",children:[!l.wantReview&&(!i||!JSON.parse(i).includes(t==null?void 0:t._id))?e.jsx("button",{className:"writeReviewButton",onClick:()=>s({wantReview:!0}),type:"button",children:"✏️ Đánh giá"}):i&&JSON.parse(i).includes(t==null?void 0:t._id)?e.jsx("h3",{style:{color:"rgba(211,211,211,0.8)"},children:"Bạn đã bình luận phim này rồi!"}):null,l.wantReview?e.jsxs("form",{onSubmit:a=>c(a),children:[e.jsxs("div",{className:"noReviewFlex",children:[e.jsxs("div",{style:{width:"49%"},className:"noReviewFlexChild",children:[e.jsx("label",{className:"labelContent",htmlFor:"noReviewNewIn4",children:"Tên *"}),e.jsx("input",{value:l.name,onChange:a=>s({name:a.target.value}),className:"textareaContent",id:"noReviewNewIn4",required:!0})]}),e.jsx("div",{style:{width:"49%"},className:"noReviewFlexChild",children:e.jsxs("div",{className:"rate",children:[e.jsx("input",{type:"radio",style:{display:"none"},required:!0}),e.jsx("input",{type:"radio",onChange:a=>s({stars:a.target.value}),id:"star5",name:"rate",value:"5"}),e.jsx("label",{title:"text",htmlFor:"star5"}),e.jsx("input",{type:"radio",onChange:a=>s({stars:a.target.value}),id:"star4",name:"rate",value:"4"}),e.jsx("label",{title:"text",htmlFor:"star4"}),e.jsx("input",{type:"radio",onChange:a=>s({stars:a.target.value}),id:"star3",name:"rate",value:"3"}),e.jsx("label",{title:"text",htmlFor:"star3"}),e.jsx("input",{type:"radio",onChange:a=>s({stars:a.target.value}),id:"star2",name:"rate",value:"2"}),e.jsx("label",{title:"text",htmlFor:"star2"}),e.jsx("input",{type:"radio",onChange:a=>s({stars:a.target.value}),id:"star1",name:"rate",value:"1"}),e.jsx("label",{title:"text",htmlFor:"star1"})]})})]}),e.jsxs("div",{className:"noReviewFlexChild",children:[e.jsx("label",{className:"labelContent",htmlFor:"noReviewNewContent",children:"Nội dung *"}),e.jsx("textarea",{value:l.content,onChange:a=>s({content:a.target.value}),style:{height:200},className:"textareaContent",id:"noReviewNewContent",required:!0})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:15},children:[e.jsx("button",{type:"submit",className:"noReviewButton",children:"Gửi"}),e.jsx("button",{onClick:()=>s({wantReview:!1}),type:"button",className:"noReviewButton2",children:"Hủy"})]})]}):null,e.jsxs("div",{className:"listReviewCover",children:[t!=null&&t.comments?t==null?void 0:t.comments.slice(0,6*l.countComments).map((a,r)=>e.jsxs("div",{className:"listReview",children:[e.jsx("div",{className:"nameReview",children:a.name}),e.jsxs("div",{className:"sideIn4Review",children:[e.jsx("span",{children:`${a.stars?n(a.stars):n(5)}`})," • ",`${new Date(a.time).toLocaleString()}`]}),e.jsx("div",{className:"contentReview",children:a.content})]},r)):window.innerWidth<=991?e.jsx(p,{containerClassName:"listReview",count:3}):e.jsxs(e.Fragment,{children:[e.jsx(p,{containerClassName:"listReview",count:3}),e.jsx(p,{containerClassName:"listReview",count:3})]}),(t==null?void 0:t.comments.length)>6?e.jsx("button",{onClick:()=>s({countComments:l.countComments+6}),type:"button",className:"plusMoreComment",children:"Xem thêm đánh giá"}):null]})]})}export{R as H,C as N};
