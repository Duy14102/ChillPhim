import{B as M,X as k,r as v,u as C,j as e}from"./index-DS5FZUpn.js";import{N as I,H as D}from"./HaveReview-DYkSGq2n.js";import{L}from"./LandingMovie-DC_KACF4.js";import{a as c}from"./axios-CCb-kr4I.js";import"./ToastUpdate-CK40nDRU.js";function B({message:n}){M.success(n,{isLoading:!1,position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,draggable:!0,progress:void 0,theme:"dark",transition:k})}function R(){var p,d,f,x,S,N,j,b;const n=v.useRef(),s=C(),[t,o]=v.useReducer((i,r)=>({...i,...r}),{movies:null,similarMovies:null,light:!1,servers:0,wantChangeServer:!0});v.useEffect(()=>{n.current.scrollIntoView({behavior:"smooth"}),u()},[]);const y=i=>i?i.sort(()=>Math.random()-.5):[];function m(){const i={method:"post",url:"http://localhost:3000/api/v1/countMoviesView",data:{subtitle:s.Name}};c(i).then(r=>{console.log(r.data.message)})}function u(){const i={method:"get",url:"http://localhost:3000/api/v1/getMoviesIn4",params:{subtitle:s.Name,eps:s.Ep}};c(i).then(r=>{o({movies:r.data.movies,similarMovies:r.data.similarMovies});const l=JSON.parse(localStorage.getItem("MovieStorage"));if(l)if(l.filter(a=>a.title===s.Name).length===0){var h={title:s.Name,eps:s.Ep,time:Date.now()};l.push(h),localStorage.setItem("MovieStorage",JSON.stringify(l)),m()}else l.filter(a=>a.title===s.Name).map(a=>(new Date(a.time).getFullYear()<new Date(Date.now()).getFullYear()&&m(),a.eps!==s.Ep&&(a.eps=s.Ep),a.time=Date.now(),localStorage.setItem("MovieStorage",JSON.stringify(l)),null));else{var w=[],h={title:s.Name,eps:s.Ep,time:Date.now()};w.push(h),localStorage.setItem("MovieStorage",JSON.stringify(w)),m()}})}function g(){var i;return s.Ep.includes("Full")||parseInt(s.Ep.match(/\d/g).join(""))>=((i=t.movies)==null?void 0:i.filmSources.length)?s.Ep:`Tập ${parseInt(s.Ep.match(/\d/g).join(""))+1}`}function E(i){o({servers:i}),n.current.scrollIntoView({behavior:"smooth"}),B({message:"Đổi server thành công!"})}return e.jsxs("div",{style:{background:t.light?"black":null},className:"streaming",children:[e.jsxs("div",{className:"titleStreaming",children:[e.jsx("a",{href:`/Information/${(p=t.movies)==null?void 0:p.subtitle}`,className:"titleLinkStreaming",children:(d=t.movies)==null?void 0:d.title}),e.jsxs("div",{className:"botStreaming",children:[e.jsx("p",{children:s.Ep}),e.jsx("a",{href:`/Information/${(f=t.movies)==null?void 0:f.subtitle}`,className:"in4LinkStreaming",children:"ℹ️"})]})]}),e.jsxs("div",{ref:n,className:"videoStreaming",children:[e.jsx("iframe",{id:"myFrame",allowFullScreen:!0,src:(x=t.movies)==null?void 0:x.filmSources.filter(i=>i.title===s.Ep)[0].servers[t.servers]}),e.jsxs("button",{onClick:()=>o({wantChangeServer:!t.wantChangeServer}),type:"button",className:"chooseServers",children:[e.jsx("svg",{style:t.wantChangeServer?{rotate:"90deg"}:null,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"})}),t.wantChangeServer?e.jsx("div",{className:"serverDropdown",children:(S=t.movies)==null?void 0:S.filmSources.filter(i=>i.title===s.Ep)[0].servers.map((i,r)=>e.jsxs("div",{style:t.servers===r?{background:"#94b1f2"}:null,onClick:()=>E(r),type:"button",className:"serverButton",children:["Server ",r+1]},r))}):null]})]}),e.jsxs("div",{style:{background:t.light?"black":null},className:"buttonStreaming",children:[e.jsx("button",{className:"buttonDefault buttonIn4",href:`/Information/${s.Name}`,children:"⚠️"}),e.jsx("button",{onClick:()=>o({light:!t.light}),className:"buttonDefault buttonLight",type:"button",children:t.light?"Bật đèn":"Tắt đèn"}),e.jsx("a",{style:{pointerEvents:g()===s.Ep?"none":null},href:`/Streaming/${s.Name}/${g()}`,className:"buttonDefault buttonPrevNext",type:"button",children:"Tập tiếp ►"})]}),e.jsxs("div",{style:{opacity:t.light?0:null},className:"episodeStreaming",children:[e.jsx("h2",{children:"Danh sách tập"}),e.jsx("div",{className:"episodeCover",children:(N=t.movies)==null?void 0:N.filmSources.map(i=>e.jsx("a",{style:i.title===s.Ep?{color:"#fff",background:"#94b1f2"}:null,href:`/Streaming/${s.Name}/${i.title}`,className:"buttonEp",children:i.title},i.title))})]}),e.jsxs("div",{style:{opacity:t.light?0:null},className:"rateStreaming",children:[e.jsxs("h2",{children:["💬 Bình luận ",e.jsxs("span",{style:{color:"#fff"},children:["(",(j=t.movies)==null?void 0:j.comments.length,")"]})]}),e.jsx("div",{className:"rateCover",children:((b=t.movies)==null?void 0:b.comments.length)<1?e.jsx(I,{movies:t.movies,axios:c,callBack:u}):e.jsx(D,{movies:t.movies,axios:c,callBack:u})})]}),e.jsx("div",{style:{opacity:t.light?0:null},children:e.jsx(L,{Title:"Phim tương tự",MarginTop:window.innerWidth<=991?50:100,movie:y(t==null?void 0:t.similarMovies)})})]})}export{R as default};
